<!doctype html><html lang=en><head><title>POSTing forms &ndash; rivten - blog</title><meta name=description content="stuff"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin=anonymous><link rel=stylesheet href=https://rivten.github.io/css/colour/srcery-dark.css><link rel=stylesheet href=https://rivten.github.io/css/colour/dark-mode.css><link rel=stylesheet href=https://rivten.github.io/css/risotto.css><link rel=stylesheet href=https://rivten.github.io/css/custom.css></head><body><div class=page><header class=page__header><h1 class=page__logo><a href=https://rivten.github.io/ class=page__logo-inner>rivten - blog</a></h1><nav class="page__nav main-nav"><ul><li class=main-nav__item><a class=nav-main-item href=/about/ title>about</a></li><li class=main-nav__item><a class="nav-main-item active" href=/posts/ title=Posts>Posts</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>POSTing forms</h1></header><div class=content__body><p>I was doing some TryHackMe recently. And, while I like learning high-level tools such as BurpSuite, I <em>really</em> love hacking stuff with just the basic tool. The basic tool being <code>curl</code> in that situation.</p><p>But there was one stuff that I would <em>always</em> get wrong, no matter what. It&rsquo;s writing the <code>curl</code> command for forms. How do you encode form data ? What are these encodings ? And… why oh why ?</p><p>So this article came out of the necessity for me to understand it all. I hope it will be useful for you too.</p><h1 id=html>HTML</h1><p>That&rsquo;s where it starts, eh ?</p><p>Well there is the <code>&lt;form></code> HTML element. The <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Form>MDN documentation</a> probably does a better job than me, but I&rsquo;ll sum it up.</p><p>Here is a simple example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit.php&#34;</span> &gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span>&gt;Enter your name:&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#a6e22e>required</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Subscribe !&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><p>The most important attributes of the <code>form</code> element are:</p><ul><li><code>action</code>: the URL that process the form submission</li><li><code>enctype</code>: the MIME type of the form submission if the method is POST. You have mostly two choices for this:<ul><li><code>application/x-www-form-urlencoded</code> which is the default if the <code>enctype</code> attributes is not there</li><li><code>multipart/form-data</code> that seems to be useful to send file.</li></ul></li><li><code>method</code>: the HTTP method to send the form with. We will focus on GET and POST here.</li></ul><p>For the <code>input</code>, it can have several types (again, check the <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input>MDN documentation</a>): <code>button</code>, <code>checkbox</code>, <code>file</code>, <code>hidden</code>, <code>password</code>, <code>submit</code>, <code>text</code>, …</p><p>The attributes can be <code>name</code> or <code>required</code> to force the browser to validate them.</p><h1 id=get>GET</h1><p>I have yet to see a form using the GET method somewhere in production (but I&rsquo;m not paying attention !). My best guess is if the user wants to specify a filter in requesting a resource.</p><p>In any case, the form data are appended into the <code>action</code> url, starting with <code>?</code> and separated with. <code>&</code>.</p><p>So for example, the <code>curl</code> command would become:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://host.com/submit.php?name<span style=color:#f92672>=</span>Alphonse&amp;surname<span style=color:#f92672>=</span>Fonfon
</span></span></code></pre></div><p>And here is the HTTP request that will be sent.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>GET</span> /submit.php?name=Alphonse&amp;surname=Fonfon <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>host.com</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>curl/7.85.0</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>:</span> <span style=color:#ae81ff>*/*</span>
</span></span></code></pre></div><p>Pretty simple, eh ?</p><h1 id=post>POST</h1><p>Now. Say you want to POST data to a website. First of all, of COURSE you can check the <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST>MDN documentation</a>.</p><p>Then, there is the good old JSON-way. Or XML, or any format like that really. Just stick <code>Content-Type: application/json</code> (for JSON) in the request header and BAM. You&rsquo;ve done it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -d <span style=color:#e6db74>&#39;{&#34;name&#34;: &#34;Alphonse&#34;, &#34;surname&#34;: &#34;Fonfon&#34;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    http://host.com/submit.php
</span></span></code></pre></div><p>The requests may look like this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>POST</span> /submit.php <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>host.com</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>curl/7.85.0</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json</span>
</span></span><span style=display:flex><span>Content-Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json, */*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{<span style=color:#f92672>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;Alphonse&#34;</span>,<span style=color:#f92672>&#34;surname&#34;</span>:<span style=color:#e6db74>&#34;FonFon&#34;</span>}
</span></span></code></pre></div><p>But now… as we learned previously, there are two other MIME types that can come from form submissions: <code>application/x-www-form-urlencoded</code> and <code>multipart/form-data</code>. So, here we go.</p><h1 id=applicationx-www-form-urlencoded><code>application/x-www-form-urlencoded</code></h1><p>This is probably the most common case, and it also happens to be the one <code>curl</code> picks by default. If no <code>enctype</code> is specified, then it&rsquo;s the expected format on the server&rsquo;s side.</p><p>Basically, you just put all you data in a <code>input=value</code> format and split them with <code>&</code>. Don&rsquo;t forget to set the header <code>Content-Type: application/x-www-form-urlencoded</code>.</p><p>The request might look something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>POST</span> /submit.php <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>host.com</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>curl/7.85.0</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/x-www-form-urlencoded</span>
</span></span><span style=display:flex><span>Content-Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json, */*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name=Alphonse&amp;surname=FonFon
</span></span></code></pre></div><p>And to invoke with <code>curl</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -d name<span style=color:#f92672>=</span>Alphonse -d surname<span style=color:#f92672>=</span>Fonfon <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    http://host.com/submit.php
</span></span></code></pre></div><h1 id=multipartform-data><code>multipart/form-data</code></h1><p>So. This one is largely describe in <a href=https://www.ietf.org/rfc/rfc2388.txt>RFC 2388</a>. You can go check it out.</p><p>As the name suggests, the message is sent in multiple parts. Parts are separated by a string boundary. These boundaries specify a type and a disposition. With this, you can easily encode binary data, as it can be just a part of the overall form submission.</p><p>The tricky part here is that the binary encoding you choose should never looks the same as the boundary of the MIME type. Otherwise, the server cannot distinguish between if this is part of the file or just a boundary to another part.</p><p>Also, the binary encoding is the reason why there exists two MIME type for form submission. You see, in <code>application/x-www-form-urlencoded</code>, if you want to submit a non-alphanumeric character, you have to encode it as <code>%HH</code> where <code>HH</code> is the hexadecimal value of the ASCII character (don&rsquo;t ask me about Unicode now). So, with this, one byte might be encoded as three bytes. This is why the <code>multipart/form-data</code> exists, to be able to pass binary data… such as files ! And this is why the MDN documentation stated that it&rsquo;s its main usage.</p><p>Here is an example of such a request.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#a6e22e>POST</span> /submit.php <span style=color:#66d9ef>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span>Host<span style=color:#f92672>:</span> <span style=color:#ae81ff>host.com</span>
</span></span><span style=display:flex><span>User-Agent<span style=color:#f92672>:</span> <span style=color:#ae81ff>curl/7.85.0</span>
</span></span><span style=display:flex><span>Accept<span style=color:#f92672>:</span> <span style=color:#ae81ff>application/json, */*</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#f92672>:</span> <span style=color:#ae81ff>multipart/form-data; boundary=---------------------------9051914041544843365972754266</span>
</span></span><span style=display:flex><span>Content-Length<span style=color:#f92672>:</span> <span style=color:#ae81ff>554</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------------------9051914041544843365972754266
</span></span><span style=display:flex><span>Content-Disposition: form-data; name=&#34;text&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>text default
</span></span><span style=display:flex><span>-----------------------------9051914041544843365972754266
</span></span><span style=display:flex><span>Content-Disposition: form-data; name=&#34;file1&#34;; filename=&#34;a.txt&#34;
</span></span><span style=display:flex><span>Content-Type: text/plain
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Content of a.txt.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------------------9051914041544843365972754266
</span></span><span style=display:flex><span>Content-Disposition: form-data; name=&#34;file2&#34;; filename=&#34;a.html&#34;
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;!DOCTYPE html&gt;&lt;title&gt;Content of a.html.&lt;/title&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------------------9051914041544843365972754266--
</span></span></code></pre></div><p>Also, you could for example send the file data encoded in base 64. (Useless note, but each boundary starts with <em>two dashes</em>, even if the boundary declared in the content type has dashes. This is why each boundary have two more dashes, even if it is hard to see. Also the last boundary always has two dashes at the end.)</p><p>Now, why don&rsquo;t we <em>always</em> send data with <code>multipart/form-data</code> ? Well the boundary also takes some room, and it takes room for each input in the form. So, for small form submission, you are probably better off with the first option.</p><p>Phew. Finally, and to conclude, this is how to send <code>multipart/form-data</code> with <code>curl</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -F name<span style=color:#f92672>=</span>Alphonse -F file<span style=color:#f92672>=</span>@file/on/my/system.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    http://host.com/submit.php
</span></span></code></pre></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><h1 class=about__title>rivten</h1><p class=about__description>stuff</p></div><ul class=aside__social-links></ul></div><hr><div class=aside__content><p>2022-10-13</p></div></section><footer class=page__footer><p class=copyright></p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and (custom) <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>